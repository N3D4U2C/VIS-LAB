version: '2'
services:
 webshop-db:
   image: web-shop-db-image
   volumes:
     - "./.data/db:/var/lib/mysql"
   restart: always
   environment:
     MYSQL_ROOT_PASSWORD: c8de110f37300a53a971749
     MYSQL_DATABASE: ${MYSQL_WEBSHOP_DB_DATABASE}
     MYSQL_USER: ${MYSQL_WEBSHOP_DB_USER}
     MYSQL_PASSWORD: ${MYSQL_WEBSHOP_DB_PASSWORD}
   ports:
     - "${MYSQL_WEBSHOP_DB_PORT}:3306"

 categoryservice:
   depends_on:
     - webshop-db
   image: ${DOCKER_USER}/${DOCKER_PROJECT_IMAGE_PREFIX}-categoryservice
   links:
     - webshop-db:${MYSQL_WEBSHOP_DB_ADDR}
   restart: always
   environment:
     MYSQL_WEBSHOP_DB_ADDR: ${MYSQL_WEBSHOP_DB_ADDR}
     MYSQL_WEBSHOP_DB_PORT: ${MYSQL_WEBSHOP_DB_PORT}
     MYSQL_WEBSHOP_DB_DATABASE: ${MYSQL_WEBSHOP_DB_DATABASE}
     MYSQL_WEBSHOP_DB_USER: ${MYSQL_WEBSHOP_DB_USER}
     MYSQL_WEBSHOP_DB_PASSWORD: ${MYSQL_WEBSHOP_DB_PASSWORD}
   ports:
     - "8081:8080"

 productservice:
   depends_on:
     - webshop-db
   image: ${DOCKER_USER}/${DOCKER_PROJECT_IMAGE_PREFIX}-productservice
   links:
     - webshop-db:${MYSQL_WEBSHOP_DB_ADDR}
   restart: always
   environment:
     MYSQL_WEBSHOP_DB_ADDR: ${MYSQL_WEBSHOP_DB_ADDR}
     MYSQL_WEBSHOP_DB_PORT: ${MYSQL_WEBSHOP_DB_PORT}
     MYSQL_WEBSHOP_DB_DATABASE: ${MYSQL_WEBSHOP_DB_DATABASE}
     MYSQL_WEBSHOP_DB_USER: ${MYSQL_WEBSHOP_DB_USER}
     MYSQL_WEBSHOP_DB_PASSWORD: ${MYSQL_WEBSHOP_DB_PASSWORD}
   ports:
     - "8082:8080"

 userservice:
   depends_on:
     - webshop-db
   image: ${DOCKER_USER}/${DOCKER_PROJECT_IMAGE_PREFIX}-userservice
   links:
     - webshop-db:${MYSQL_WEBSHOP_DB_ADDR}
   restart: always
   environment:
     MYSQL_WEBSHOP_DB_ADDR: ${MYSQL_WEBSHOP_DB_ADDR}
     MYSQL_WEBSHOP_DB_PORT: ${MYSQL_WEBSHOP_DB_PORT}
     MYSQL_WEBSHOP_DB_DATABASE: ${MYSQL_WEBSHOP_DB_DATABASE}
     MYSQL_WEBSHOP_DB_USER: ${MYSQL_WEBSHOP_DB_USER}
     MYSQL_WEBSHOP_DB_PASSWORD: ${MYSQL_WEBSHOP_DB_PASSWORD}
   ports:
     - "8083:8080"

 categorycompositeservice:
   image: ${DOCKER_USER}/${DOCKER_PROJECT_IMAGE_PREFIX}-categorycompositeservice
   restart: always
   ports:
     - "8084:8080"

 discovery:
   image: ${DOCKER_USER}/${DOCKER_PROJECT_IMAGE_PREFIX}-discovery
   restart: always
   ports:
     - "8761:8761"

 api-gateway:
   image: ${DOCKER_USER}/${DOCKER_PROJECT_IMAGE_PREFIX}-api-gateway
   restart: always
   ports:
     - "8765:8765"

 dashboard:
   image: ${DOCKER_USER}/${DOCKER_PROJECT_IMAGE_PREFIX}-dashboard
   links:
     - categorycompositeservice
     - api-gateway
   restart: always
   ports:
     - "7979:7979"

 uaa-service:
   image: ${DOCKER_USER}/${DOCKER_PROJECT_IMAGE_PREFIX}-uaa-service
   restart: always
   ports:
     - "8769:8769"

 dummy-service:
   image: ${DOCKER_USER}/${DOCKER_PROJECT_IMAGE_PREFIX}-dummy-service
   restart: always
   ports:
     - "8870:8870"

 legacywebshop-micro:
   image: tomcat:8.0
   restart: always
   volumes:
     - ./LegacyWebShop_Micro/target/EShop-Micro-2.0.0.war:/usr/local/tomcat/webapps/EShop-Micro-2.0.0.war
     - ./LegacyWebShop_Micro/conf/tomcat-users.xml:/usr/local/tomcat/conf/tomcat-users.xml
   links:
     - api-gateway
   ports:
     - "8899:8080"
